<div class='main'>
    <div class='content full'>
        <div class='row' style="margin:0px;">
            <div class='col-md-12 '>

                <p-table #dt [value]="products" id="product-list" autoLayout="true" [loading]="loading" [scrollable]="true" [scrollHeight]="windowsHeight()"
                    rowHover="true">
                    <ng-template pTemplate="caption">

                        <button type="button" id="btnOpenProductAddForm" class="btn btn-primary btn-sm" (click)="showDialogToAdd()">Yeni
                            <i class="fa fa-plus-circle" aria-hidden="true"></i>
                        </button>
                        Ürün Listesi
                    </ng-template>
                    <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                            <col [style.width]="'8%'">
                            <!--iamge-->
                            <col [style.width]="'15%'">
                            <!--barcode-->
                            <col [style.width]="'8%'">
                            <!--order number-->
                            <col [style.width]="'20%'">
                            <!--name-->
                            <col [style.width]="'10%'">
                            <!--purchase Price-->
                            <col [style.width]="'10%'">
                            <!--netSalePrice-->
                            <col [style.width]="'8%'">
                            <!--Tax-->
                            <col [style.width]="'10%'">
                            <!--Brut-->
                        </colgroup>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Resim</th>
                            <th [pSortableColumn]="'barcodeOfProduct'">Barkod
                                <p-sortIcon></p-sortIcon>
                            </th>
                            <th [pSortableColumn]="'orderNumber'">S.NR
                                <p-sortIcon></p-sortIcon>
                            </th>
                            <th [pSortableColumn]="'productName'">Ürün Adı
                                <p-sortIcon></p-sortIcon>
                            </th>
                            <th [pSortableColumn]="'purchasePrice'">Alış(€)
                                <p-sortIcon></p-sortIcon>
                            </th>
                            <th [pSortableColumn]="'netSalePrice'">Net Satış(€)
                                <p-sortIcon></p-sortIcon>
                            </th>
                            <th [pSortableColumn]="'tax'">Vergi(%)
                                <p-sortIcon></p-sortIcon>
                            </th>
                            <th>Brüt Satış(€)</th>

                        </tr>
                        <tr>
                            <!--Searching Controls-->
                            <th>

                            </th>
                            <th>
                                <input placeholder="Barkod..." pInputText type="text" (input)="dt.filter($event.target.value, 'barcodeOfProduct','contains')">
                            </th>
                            <th>
                                <input placeholder="S.No..." pInputText type="text" (input)="dt.filter($event.target.value, 'orderNumber','contains')">
                            </th>
                            <th>
                                <input placeholder="Ürün Adı..." pInputText type="text" (input)="dt.filter($event.target.value, 'productName','contains')">
                            </th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-pro>
                        <tr [pSelectableRow]="pro">
                            <td>
                                <img class="product-image" (click)="showImgDialog(pro)" src="http://dev.goralgmbh.com/assets/images/products/{{pro.barcodeOfProduct}}.jpg"
                                    [alt]="pro.productName">
                            </td>
                            <td (click)="onRowSelect(pro)">{{pro.barcodeOfProduct}}</td>
                            <td (click)="onRowSelect(pro)">{{pro.orderNumber}}</td>
                            <td (click)="onRowSelect(pro)">{{pro.productName}}</td>
                            <td (click)="onRowSelect(pro)">{{pro.purchasePrice | number:'1.2-2':'de'}}</td>
                            <td (click)="onRowSelect(pro)">{{pro.netSalePrice | number:'1.2-2':'de'}}</td>
                            <td (click)="onRowSelect(pro)">{{pro.tax}}</td>
                            <td (click)="onRowSelect(pro)">{{pro.netSalePrice+pro.netSalePrice*pro.tax/100 | number:'1.2-2':'de'}}</td>
                        </tr>
                    </ng-template>
                </p-table>
                <div>
                </div>
            </div>
        </div>

        <p-dialog [header]="newProduct==true?'Yeni Ürün':'Ürün Detayı'" [(visible)]="displayDialog" [responsive]="true" [contentStyle]="{'width':'100%'}"
            showEffect="fade" [modal]="true">
            <div>
                <form class="" #productForm="ngForm">
                    <div class="row">
                        <div class="col-sm-7 border-right">
                            <div class="form-group row">
                                <label for="barcodeOfProduct" class="col-sm-3 col-form-label">Barkod</label>
                                <div class="col-sm-9">
                                    <input pInputText pKeyFilter="pint" id="barcodeOfProduct" name="barcodeOfProduct" [(ngModel)]="product.barcodeOfProduct"
                                        #barcodeOfProduct="ngModel" required class="form-control form-control-sm" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="productName" class="col-sm-3">Ürün Adı</label>
                                <div class="col-sm-9">
                                    <input pInputText id="productName" name="productName" [(ngModel)]="product.productName" class="form-control form-control-sm "
                                        required/>
                                </div>

                            </div>
                            <div class="form-group row">
                                <label for="orderNumber" class="col-sm-3">Sipariş No</label>
                                <div class="col-sm-9">
                                    <input pInputText id="orderNumber" name="orderNumber" [(ngModel)]="product.orderNumber" class="form-control form-control-sm"
                                        required />
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="purchasePrice" class="col-sm-3">Alış Fiyatı</label>
                                <div class="col-sm-9">
                                    <input pKeyFilter="money" pInputText id="purchasePrice" name="purchasePrice" [(ngModel)]="product.purchasePrice" class="form-control form-control-sm"
                                    />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="netSalePrice" class="col-sm-3">Satış Fiyatı</label>
                                <div class="col-sm-9">
                                    <input pKeyFilter="money" pInputText id="netSalePrice" name="netSalePrice" [(ngModel)]="product.netSalePrice" class="form-control form-control-sm"
                                    />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="barcodeOfPackage" class="col-sm-3">K.Barkodu</label>
                                <div class="col-sm-9">
                                    <input pKeyFilter="pint" pInputText id="barcodeOfPackage" #barcodeOfPackage="ngModel" name="barcodeOfPackage" [(ngModel)]="product.barcodeOfPackage"
                                        class="form-control form-control-sm" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="descripton" class="col-sm-3">Açıklama</label>
                                <div class="col-sm-9">
                                    <textarea [(ngModel)]="product.descripton" name="descripton" class="form-control"></textarea>
                                </div>
                            </div>



                        </div>
                        <div class="col-sm-5">

                            <div class="form-group row">
                                <label for="brands" class="col-sm-3">Marka</label>
                                <div class="col-sm-9">
                                    <p-dropdown [options]="brands" [(ngModel)]="selectedBrand" name="brands" [filter]="true" appendTo="body" placeholder="Marka sec"
                                        optionLabel="name" [style]="{'width':'100%'}" styleClass="ui-column-filter"></p-dropdown>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="categories" class="col-sm-3">Kategori</label>
                                <div class="col-sm-9">
                                    <p-dropdown [options]="categories" [filter]="true" appendTo="body" [(ngModel)]="selectedCategory" name="categories" placeholder="Kategori"
                                        optionLabel="name" [style]="{'width':'100%'}" styleClass="ui-column-filter"></p-dropdown>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="taxNumbers" class="col-sm-3">Vergi</label>
                                <div class="col-sm-9">
                                    <p-dropdown [options]="taxNumbers" [filter]="true" appendTo="body" name="taxNumbers" [(ngModel)]="selectedTax" placeholder="Vergi Sec"
                                        optionLabel="data" [style]="{'width':'100%'}" styleClass="ui-column-filter"></p-dropdown>
                                </div>

                            </div>
                            <div class="form-group row">
                                <label for="suppliers" class="col-sm-3">Toptancı</label>
                                <div class="col-sm-9">
                                    <p-dropdown [options]="suppliers" [filter]="true" appendTo="body" name="suppliers" [(ngModel)]="selectedSupplier" placeholder="Tedarikci Sec"
                                        optionLabel="name" [style]="{'width':'100%'}" styleClass="ui-column-filter"></p-dropdown>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="units" class="col-sm-3">Birim</label>
                                <div class="col-sm-9">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <input pKeyFilter="money" pInputText id="quantity" name="quantity" [(ngModel)]="product.quantity" class="form-control form-control-sm"
                                            />
                                        </div>
                                        <div class="col-sm-6">
                                            <p-dropdown [options]="units" name="units" [filter]="true" appendTo="body" [(ngModel)]="selectedUnit" placeholder="g,kg,l,ml"
                                                optionLabel="name" [style]="{'width':'100%'}" styleClass="ui-column-filter"></p-dropdown>
                                        </div>
                                    </div>



                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="unitsInPackage" class="col-sm-3">K.Adet</label>
                                <div class="col-sm-9">
                                    <input pInputText id="unitsInPackage" name="unitsInPackage" [(ngModel)]="product.unitsInPackage" class="form-control form-control-sm"
                                    />
                                </div>
                            </div>
                        </div>

                    </div>
                </form>
            </div>
            <p-footer>
                <div class="ui-dialog-buttonpane ui-helper-clearfix">
                    <button type="button" class="ui-button-danger" [disabled]="newProduct" pButton icon="fa-close" (click)="delete()" label="{{deleteButtonText}}"></button>
                    <button type="button" class="ui-button-success" [disabled]="!productForm.form.valid    ||selectedCategory.name==null" pButton
                        icon="fa-check" (click)="save()" label="Kaydet"></button>
                </div>
            </p-footer>
        </p-dialog>

        <p-dialog header="Resin Yukle" [(visible)]="displayChangeImg" [responsive]="true" [contentStyle]="{'width':'100%'}" showEffect="fade"
            [modal]="true">
            <div>
                <form class="" #ImgForm="ngForm">
                    <div class="row">
                        <div class="col-sm-6 border-right">
                            <div class="form-group row">
                                <div [hidden]="hideImageUrl" class="col-sm-6">
                                    <img class="saveProduct-image" src="http://goralgmbh.com/assets/images/products/{{product.barcodeOfProduct}}.jpg">
                                </div>
                                <div class="" [hidden]="!hideImageUrl">
                                    <image-cropper   class="saveProduct-image"
                                     [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true" [aspectRatio]="400 /400" [resizeToWidth]="0"
                                        format="png" (imageCropped)="imageCropped($event)" (imageLoaded)="imageLoaded()" (loadImageFailed)="loadImageFailed()"></image-cropper>
                                </div>

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div>
                                <img class="saveProduct-image" [hidden]="!hideImageUrl" type="file" #fileInput [src]="croppedImage" />
                            </div>
                        </div>

                    </div>
                </form>
            </div>
            <p-footer>
                <div class="ui-dialog-buttonpane ui-helper-clearfix">
                    <input type="file" id="getFile" (click)="fileChangeEvent($event)" style="display:none" />
                    <button type="button" id="btnUpload" class="btn btn-success btn-sm" (click)="addFile()">Kaydet
                            <i class="fa fa-check" aria-hidden="true"></i>
                        </button>

                    <button type="button" id="btnUpload" class="btn btn-primary btn-sm"  onclick="document.getElementById('getFile').click()">Resim Sec
                            <i class="fa fa-plus-circle" aria-hidden="true"></i>
                        </button>

                </div>
            </p-footer>
        </p-dialog>